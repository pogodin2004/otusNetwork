# Лабораторная работа - Настройка протоколов CDP, LLDP и NTP
## Топология
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/topology.png)
## Таблица адресации
| Устройство | Интерфейс  | IP-адрес   | Маска подсети | Шлюз по умолчанию |
| ---------- |------------|------------|---------------|-------------------|
| R1         | Loopback1  | 172.16.1.1 | 255.255.255.0 | -                 |
|            | G0/0/1     | 10.22.0.1  | 255.255.255.0 |                   |
| S1         | SVI VLAN 1 | 10.22.0.2  | 255.255.255.0 | 10.22.0.1         |
| S2         | SVI VLAN 1 | 10.22.0.3  | 255.255.255.0 | 10.22.0.1         |

## Цели
### Часть 1. Создание сети и настройка основных параметров устройства
### Часть 2. Обнаружение сетевых ресурсов с помощью протокола CDP
### Часть 3. Обнаружение сетевых ресурсов с помощью протокола LLDP
### Часть 4. Настройка и проверка NTP

## Общие сведения/сценарий

   Протокол Cisco Discovery Protocol (CDP) — собственный протокол Cisco для обнаружения сетевых ресурсов, функционирующий на канальном уровне. Он служит для обмена информацией, например именами устройств и версиями ПО IOS, с другими физически подключенными устройствами Cisco. Протокол Link Layer Discovery Protocol (LLDP) — это не зависящий от производителя протокол для обнаружения сетевых ресурсов, функционирующий на канальном уровне. В основном он используется сетевыми устройствами в локальной сети (LAN). Сетевые устройства сообщают соседям такие данные о себе, как идентификаторы и сведения о функциональных возможностях.

   Протокол сетевого времени (NTP) служит для синхронизации времени между распределенными серверами времени и клиентами. В качестве транспортного протокола NTP использует протокол UDP. Все операции обмена данными по протоколу NTP выполняются по времени в формате UTC.

   Сервер NTP обычно получает данные о времени из достоверного источника, такого как атомные часы, к которым подключен сервер. Затем он распределяет это время по сети. Протокол NTP чрезвычайно эффективен; для синхронизации времени на двух компьютерах с временной разницей в пределах миллисекунды требуется отправлять не более одного пакета в минуту.

   В этой лабораторной работе вам предстоит задокументировать порты, которые используются для подключения к другим коммутаторам по протоколам CDP и LLDP. Полученные результаты следует указать в диаграмме сетевой топологии. 

   **Примечание:** Маршрутизаторы, используемые в практических лабораторных работах CCNA, - это Cisco 4221 с Cisco IOS XE Release 16.9.4 (образ universalk9). В лабораторных работах используются коммутаторы Cisco Catalyst 2960 с Cisco IOS версии 15.2(2) (образ lanbasek9). Можно использовать другие маршрутизаторы, коммутаторы и версии Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. Правильные идентификаторы интерфейса см. в сводной таблице по интерфейсам маршрутизаторов в конце лабораторной работы.

   **Примечание.** Убедитесь, что у всех маршрутизаторов и коммутаторов была удалена начальная конфигурация. Если вы не уверены в этом, обратитесь к инструктору.

## Необходимые ресурсы
   * 1 Маршрутизатор (Cisco 4221 с универсальным образом Cisco IOS XE версии 16.9.4 или аналогичным)

   * 2 коммутатора (Cisco 2960 с операционной системой Cisco IOS 15.2(2) (образ lanbasek9) или аналогичная модель)

   * 1 ПК (под управлением Windows с программой эмуляции терминала, например, Tera Term)

   * Консольные кабели для настройки устройств Cisco IOS через консольные порты.

   * Кабели Ethernet, расположенные в соответствии с топологией.

## Часть 1. Создание сети и настройка основных параметров устройства

   В первой части лабораторной работы вам предстоит создать топологию сети и настроить основные параметры для маршрутизатора и коммутаторов
   
### Шаг 1. Создайте сеть согласно топологии.

  Подключите устройства, как показано в топологии, и подсоедините необходимые кабели.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/my_topology.png)

### Шаг 2. Настройте базовые параметры для маршрутизатора.

   a. Назначьте маршрутизатору имя устройства.

   b. Отключите поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.

   c. Назначьте **class** в качестве зашифрованного пароля привилегированного режима EXEC.

   d. Назначьте **cisco** в качестве пароля консоли и включите вход в систему по паролю.

   e. Назначьте **cisco** в качестве пароля VTY и включите вход в систему по паролю.

   f. Зашифруйте открытые пароли.

   g. Создайте баннер с предупреждением о запрете несанкционированного доступа к устройству.

   h. Настройка интерфейсов, перечисленных в таблице выше

   i. Сохраните текущую конфигурацию в файл загрузочной конфигурации.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_basic_conf.png)

### Шаг 3. Настройте базовые параметры каждого коммутатора.

   a. Присвойте коммутатору имя устройства.

   b. Отключите поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.

   c. Назначьте class в качестве зашифрованного пароля привилегированного режима EXEC.

   d. Назначьте cisco в качестве пароля консоли и включите вход в систему по паролю.

   e. Назначьте cisco в качестве пароля VTY и включите вход в систему по паролю.

   f. Зашифруйте открытые пароли.

   g. Создайте баннер, который предупреждает всех, кто обращается к устройству, видит баннерное сообщение «Только авторизованные пользователи!».  

   h. Отключите неиспользуемые интерфейсы

   i. Сохраните текущую конфигурацию в файл загрузочной конфигурации.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_basic_conf.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_basic_conf.png)

## Часть 2. Обнаружение сетевых ресурсов с помощью протокола CDP

   На устройствах Cisco протокол CDP включен по умолчанию. Воспользуйтесь CDP, чтобы обнаружить порты, к которым подключены кабели.

   a. На R1 используйте соответствующую команду show cdp, чтобы определить, сколько интерфейсов включено CDP, сколько из них включено и сколько отключено.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_sh_cdp_int.png)

   Сколько интерфейсов участвует в объявлениях CDP? Какие из них активны?

```
2 физических интерефейса и VLAN. Активен интерфейс GigabitEthernet0/0/1
```

   b. На R1 используйте соответствующую команду show cdp, чтобы определить версию IOS, используемую на S1.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_sh_cdp_ent.png)

   Какая версия IOS используется на  S1?

```
Cisco IOS Software, C2960 Software (C2960-LANBASEK9-M), Version 15.0(2)SE4
```
 
   c. На S1 используйте соответствующую команду show cdp, чтобы определить, сколько пакетов CDP было выданных.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_sh_cdp_err.png)

   Сколько пакетов имеет выход CDP с момента последнего сброса счетчика?

```
В CPT не предусмотрены команды работы с пакетами в CDP.
```
 
   d. Настройте SVI для VLAN 1 на S1 и S2, используя IP-адреса, указанные в таблице адресации выше. Настройте шлюз по умолчанию для каждого коммутатора на основе таблицы адресов.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_vlan1.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_vlan1.png)
 
   e. На R1 выполните команду **show cdp entry S1.**

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_sh_cdp_s1.png)

   Какие дополнительные сведения доступны теперь?

```
Появилась информация об ip-адресе коммутатора S1: 10.22.0.2
```

   f. Отключить CDP глобально на всех устройствах. 

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_no_cdp.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_no_cdp.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_no_cdp.png)

## Часть 3. Обнаружение сетевых ресурсов с помощью протокола LLDP

   На устройствах Cisco протокол LLDP может быть включен по умолчанию. Воспользуйтесь LLDP, чтобы обнаружить порты, к которым подключены кабели.

   a. Введите соответствующую команду **lldp,** чтобы включить LLDP на всех устройствах в топологии.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_lldp_run.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_lldp_run.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_lldp_run.png)

   b. На S1 выполните соответствующую команду **lldp,** чтобы предоставить подробную информацию о S2. 

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_lldp_err.png)

```
В CPT для lldp нет аналога команды show cdp entry S1
```

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_lldp_s2.png)

   Что такое chassis ID  для коммутатора S2?

``
MAC-адрес
```

   c. Соединитесь через консоль на всех устройствах и используйте команды LLDP, необходимые для отображения топологии физической сети только из выходных данных команды show.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_lldp_neighbors.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_lldp_neighbors.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_lldp_neighbors.png)

## Часть 4. Настройка NTP

   В части 4 необходимо настроить маршрутизатор R1 в качестве сервера NTP, а маршрутизатор R2 в качестве клиента NTP маршрутизатора R1. Необходимо выполнить синхронизацию времени для Syslog и отладочных функций. Если время не синхронизировано, сложно определить, какое сетевое событие стало причиной данного сообщения

### Шаг 1. Выведите на экран текущее время.

   Введите команду **show clock** для отображения текущего времени на R1. Запишите отображаемые сведения о текущем времени в следующей таблице.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_sh_clock.png)

| Дата       | Время      | Часовой пояс | Источник времени            |
| ---------- |------------|--------------|-----------------------------|
| 01.03.1993 | 0:1:11.979 | UTC          | Программные часы устройства |

### Шаг 2. Установите время.

   С помощью команды **clock set** установите время на маршрутизаторе R1. Введенное время должно быть в формате UTC. 

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/r1_clock_set.png)

### Шаг 3. Настройте главный сервер NTP.

  Настройте R1 в качестве хозяина NTP с уровнем слоя 4.

### Шаг 4. Настройте клиент NTP.

   a. Выполните соответствующую команду на S1 и S2, чтобы просмотреть настроенное время. Запишите текущее время,  в следующей таблице.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_sh_clock.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_sh_clock.png)

| Дата       | Время      | Часовой пояс |
| ---------- |------------|--------------|
| 01.03.1993 | 0:9:34.525 | UTC          |
| 01.03.1993 | 0:10:30.72 | UTC          |

   b. Настройте S1 и S2 в качестве клиентов NTP. Используйте соответствующие команды NTP для получения времени от интерфейса G0/0/1 R1, а также для периодического обновления календаря или аппаратных часов коммутатора.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_ntp_client.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_ntp_client.png)

### Шаг 5. Проверьте настройку NTP.

   a. Используйте соответствующую команду **show,** чтобы убедиться, что S1 и S2 синхронизированы с R1.

   **Примечание.** Синхронизация метки времени на маршрутизаторе R2 с меткой времени на маршрутизаторе R1 может занять несколько минут.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_ntp_conf.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_ntp_conf.png)

   b. Выполните соответствующую команду на S1 и S2, чтобы просмотреть настроенное время и сравнить ранее записанное время.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s1_sh_clock_det.png)
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz13/images/s2_sh_clock_det.png)

### Вопрос для повторения
   Для каких интерфейсов в пределах сети не следует использовать протоколы обнаружения сетевых ресурсов? Поясните ответ.

```
Протоколы CDP и LLDP рекомендуется отключать на всех интерфейсах, аодключенных к ненадежным сетям 
(Интернет - в том числе). Т.к. CDP и LLDP может быть использован для разведки и выяснения топологии сети
```



