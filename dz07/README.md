# Лабораторная работа. Развертывание коммутируемой сети с резервными каналами
## Топология
![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/topology.png)
## Таблица адресации

| Устройство | Интерфейс | IP-адрес    | Маска подсети | 
| ---------- |:---------:|:-----------:|:-------------:|
| S1         | VLAN 1    | 192.168.1.1 | 255.255.255.0 |
| S2         | VLAN 1    | 192.168.1.2 | 255.255.255.0 |
| S3         | VLAN 1    | 192.168.1.3 | 255.255.255.0 |

## Цели
### Часть 1. Создание сети и настройка основных параметров устройства
### Часть 2. Выбор корневого моста
### Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
### Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

## Общие сведения/сценарий

   Избыточность позволяет увеличить доступность устройств в топологии сети за счёт устранения единой точки отказа. Избыточность в коммутируемой сети обеспечивается посредством использования нескольких коммутаторов или нескольких каналов между коммутаторами. Когда в проекте сети используется физическая избыточность, возможно возникновение петель и дублирование кадров.

   Протокол spanning-tree (STP) был разработан как механизм предотвращения возникновения петель на 2-м уровне для избыточных каналов коммутируемой сети. Протокол STP обеспечивает наличие только одного логического пути между всеми узлами назначения в сети путем намеренного блокирования резервных путей, которые могли бы вызвать петлю.

   В этой лабораторной работе команда **show spanning-tree** используется для наблюдения за процессом выбора протоколом STP корневого моста. Также вы будете наблюдать за процессом выбора портов с учетом стоимости и приоритета.

   **Примечание.** Используются коммутаторы Cisco Catalyst 2960s с Cisco IOS версии 15.0(2) (образ lanbasek9). Допускается использование других моделей коммутаторов и других версий Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. 

   **Примечание.** Убедитесь, что все настройки коммутатора удалены и загрузочная конфигурация отсутствует. Если вы не уверены, обратитесь к инструктору.


## Необходимые ресурсы
  * 3 коммутатора (Cisco 2960 с операционной системой Cisco IOS 15.0(2) (образ lanbasek9) или аналогичная модель)
  * Консольные кабели для настройки устройств Cisco IOS через консольные порты
  * Кабели Ethernet, расположенные в соответствии с топологией

## Часть 1. Создание сети и настройка основных параметров устройства

  В части 1 вам предстоит настроить топологию сети и основные параметры коммутаторов.

### Шаг 1. Создайте сеть согласно топологии.

   Подключите устройства, как показано в топологии, и подсоедините необходимые кабели.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/my_topology.png)

### Шаг 2: Выполните инициализацию и перезагрузку коммутаторов.

```
Switch#erase startup-config 
Erasing the nvram filesystem will remove all configuration files! Continue? [confirm]y[OK]
Erase of nvram: complete
%SYS-7-NV_BLOCK_INIT: Initialized the geometry of nvram
Switch#
Switch#reload
Proceed with reload? [confirm]yC2960 Boot Loader (C2960-HBOOT-M) Version 12.2(25r)FX, RELEASE SOFTWARE (fc4)
Cisco WS-C2960-24TT (RC32300) processor (revision C0) with 21039K bytes of memory.
2960-24TT starting...
```

### Шаг 3: Настройте базовые параметры каждого коммутатора.

   a. Отключите поиск DNS.

   b. Присвойте имена устройствам в соответствии с топологией.

   c. Назначьте class в качестве зашифрованного пароля доступа к привилегированному режиму.

   d. Назначьте cisco в качестве паролей консоли и VTY и активируйте вход для консоли и VTY каналов.

   e. Настройте logging synchronous для консольного канала.

   f. Настройте баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.

   g. Задайте IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.

   h. Скопируйте текущую конфигурацию в файл загрузочной конфигурации.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s1_startup_config.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s2_startup_config.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_startup_config.png)

### Шаг 4: Проверьте связь.

   Проверьте способность компьютеров обмениваться эхо-запросами.

   Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2?

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/ping_s1-s2.png)

   Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3?

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/ping_s1-s3.png)

   Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3?

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/ping_s2-s3.png)

   Выполняйте отладку до тех пор, пока ответы на все вопросы не будут положительными.

## Часть 2: Определение корневого моста

   Для каждого экземпляра протокола spanning-tree (коммутируемая сеть LAN или широковещательный домен) существует коммутатор, выделенный в качестве корневого моста. Корневой мост служит точкой привязки для всех расчётов протокола spanning-tree, позволяя определить избыточные пути, которые следует заблокировать.

   Процесс выбора определяет, какой из коммутаторов станет корневым мостом. Коммутатор с наименьшим значением идентификатора моста (BID) становится корневым мостом. Идентификатор BID состоит из значения приоритета моста, расширенного идентификатора системы и MAC-адреса коммутатора. Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096. По умолчанию используется значение 32768.

### Шаг 1: Отключите все порты на коммутаторах.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s1_shutdown.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s2_shutdown.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_shutdown.png)
   

### Шаг 2: Настройте подключенные порты в качестве транковых.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s1_trunk_mode.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s2_trunk_mode.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_trunk_mode.png)


### Шаг 3: Включите порты F0/2 и F0/4 на всех коммутаторах.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s1_int_up.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s2_int_up.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_int_up.png)


### Шаг 4: Отобразите данные протокола spanning-tree.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s1_spa.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s2_spa.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_spa.png)

   В схему ниже запишите роль и состояние (Sts) активных портов на каждом коммутаторе в топологии.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/topology_with_stp.png)

   С учетом выходных данных, поступающих с коммутаторов, ответьте на следующие вопросы.


   Какой коммутатор является корневым мостом? 

```
Коммутатор S2 является корневым мостом.
```

   Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?

```
S2 имеет самый низкий MAC-адрес.
```

   Какие порты на коммутаторе являются корневыми портами?

```
На S1 - F0/2, на S3 - F0/2.
```

   Какие порты на коммутаторе являются назначенными портами?

```
На S1 - F0/4, на S2 - F0/2 и F0/4.
```

   Какой порт отображается в качестве альтернативного и в настоящее время заблокирован?

```
На S3 - F0/4.
```

   Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?

```
Так как S3 имеет MAC-адрес выше, чем S2.
```

## Часть 3: Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов

   Алгоритм протокола spanning-tree (STA) использует корневой мост как точку привязки, после чего определяет, какие порты будут заблокированы, исходя из стоимости пути. Порт с более низкой стоимостью пути является предпочтительным. Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Наиболее низкие значения являются предпочтительными. В части 3 вам предстоит изменить стоимость порта, чтобы определить, какой порт будет заблокирован протоколом spanning-tree

### Шаг 1: Определите коммутатор с заблокированным портом.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_blocked_port.png)


?????????????????????????????????????????????????????????????????????????????????????????????????????????????????
### Шаг 2: Измените стоимость порта.

   Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшите стоимость этого порта корневого моста до 18, выполнив команду spanning-tree cost 18 режима конфигурации интерфейса.

### Шаг 3: Просмотрите изменения протокола spanning-tree.

   Повторно выполните команду show spanning-tree на обоих коммутаторах некорневого моста. 
   
### Шаг 4: Удалите изменения стоимости порта.

??????????????????????????????????????????????????????????????????????????????????????????????????????????????

## Часть 4: Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

   Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Значение приоритета по умолчанию — 128. STP объединяет приоритет порта с номером порта, чтобы разорвать связи. Наиболее низкие значения являются предпочтительными. В части 4 вам предстоит активировать избыточные пути до каждого из коммутаторов, чтобы просмотреть, каким образом протокол STP выбирает порт с учетом приоритета портов.

   a. Включите порты F0/1 и F0/3 на всех коммутаторах.

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s1_int_up2.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s2_int_up2.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_int_up2.png)

   b. Подождите 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполните команду show spanning-tree на коммутаторах некорневого моста. 

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s1_spa2.png)

![](https://github.com/pogodin2004/otusNetwork/blob/main/dz07/images/s3_spa2.png)

   Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста? 

```
На S1 и S3 корневыми стали порты F0/1
```

   Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?

```
Они имеют наименьший порядковый номер порта.
```

## Вопросы для повторения

   1.Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?

```
Стоимость пути
```

   2. Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?

```
MAC-адрес коммутатора
```

   3. Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?

```
Порядковый номер порта на коммутаторе
```
